{% extends "PumProjectAdminBundle::layout-beam.html.twig" %}

{% set menu_active = beam.name %}

{% block content %}
    <div class="pum-row-head">
        <div class="pum-action-bar pull-right">
            {% if is_granted('ROLE_PA_EDIT') %}
                <a href="{{ path('pa_object_create', {beamName: beam.name, name: object_definition.name}) }}" class="btn pum-scheme-btn-darkgrass"><i class="pumicon pumicon-plus-3"></i>Create a {{ object_definition.name|humanize|title }}</a>
            {% endif %}
            {% if is_granted('ROLE_PA_DELETE') %}
                <a href="{{ path('pa_object_deleteall', {beamName: beam.name, name: object_definition.name}) }}" class="btn btn-danger" data-cancel="Cancel" data-confirm="Delete all" data-text='Are you sure to delete all {{ object_definition.name|humanize|title }} ?'>Delete all</a>
            {% endif %}
        </div>
        {{ pum_macros.section_title(beam.name|title, 'List of <strong>' ~ object_definition.name|humanize|title ~'</strong>', null, [
            {
                href: path('pa_homepage'),
                text: pum_project().name|humanize|title
            },
            {
                href: path('pa_beam_show', {beamName: beam.name}),
                text: beam.name|humanize|title
            },
            {
                text: object_definition.name|humanize|title
            }
        ]) }}
    </div>

    {{ pum_macros.alertMessages() }}

    <div class="lead btn-group">
        <button data-toggle="dropdown" class="btn btn-primary btn-sm dropdown-toggle" type="button">Actions <span class="caret"></span></button>
        <ul role="menu" class="dropdown-menu">
            <li>
                <a href="#" title="Delete selected entities" data-type="submit" data-form-id="entititesList" data-cancel="Cancel" data-confirm="Delete" data-text='Are you sure to delete selected entities ?'>
                    Delete selected items
                </a>
            </li>
        </ul>
    </div>

    <div class="lead btn-group  pull-right">
        {{ pum_macros.viewChoices(object_definition.tableViews, beam, object_definition) }}
    </div>

    <div class="lead btn-group pull-right">
        {{ pum_macros.paginationChoices(pager.maxPerPage, pagination_values) }}
    </div>

    <form id="entititesList" method="POST" action="{{ path('pa_object_delete_list', {beamName: beam.name, name: object_definition.name}) }}">
        <table class="table">
            <col width="50" />
            <thead>
                <tr>
                    <th class="text-center"><input type="checkbox" value="all" /></th>
                    <th class="header">
                        {{ pum_macros.sort('ID') }}
                    </th>
                    {% for columnName in table_view.visibleColumnNames %}
                        <th class="header">
                            {{ pum_macros.sort(columnName|title, table_view.columnField(columnName)) }}
                        </th>
                    {% endfor %}
                    {% if is_granted('ROLE_PA_EDIT') or is_granted('ROLE_PA_DELETE') %}
                        <th class="pum-schemed_cell">
                            <div class="pum-schemed_cell_wrapper">
                                <i class="pumicon pumicon-settings-2 hidden-xs"></i>
                                Actions
                            </div>
                        </th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% if pager.getNbResults == 0 %}
                    <tr><td colspan="{{ object_definition.fields|length }}">No {{ object_definition.name|humanize|title }} found</td></tr>
                {% endif %}
                {% for row in pager %}
                    <tr>
                        <td class="text-center"><input name="entities[]" type="checkbox" value="{{ row.get('id') }}" /></td>
                        <td>{{ row.get('id') }}</td>
                        {% for columnName in table_view.visibleColumnNames %}
                            <td>{{ pum_view_field(row, table_view.columnField(columnName)) }}</td>
                        {% endfor %}
                        {% if is_granted('ROLE_PA_EDIT') or is_granted('ROLE_PA_DELETE') %}
                            <td>
                                {% if is_granted('ROLE_PA_EDIT') %}
                                    <a href="{{ path('pa_object_edit', {beamName: beam.name, name: object_definition.name, id: row.get('id')}) }}" class="btn btn-success btn-sm">Edit</a>
                                    <a href="{{ path('pa_object_clone', {beamName: beam.name, name: object_definition.name, id: row.get('id')}) }}" class="btn btn-warning btn-sm">Clone</a>
                                {% endif %}
                                {% if is_granted('ROLE_PA_DELETE') %}
                                    <a href="{{ path('pa_object_delete', {beamName: beam.name, name: object_definition.name, id: row.get('id')}) }}" class="btn btn-danger btn-sm" data-cancel="Cancel" data-confirm="Delete" data-text='Are you sure to delete this entry ?'>Delete</a>
                                {% endif %}
                            </td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="pum-action-bar">
            <i class="pumicon pumicon-arrow-2 icon-medium text-muted"></i>
            <button type="button" class="btn btn-small btn-danger" title="Delete selected entities" data-type="submit" data-form-id="entititesList" data-cancel="Cancel" data-confirm="Delete" data-text='Are you sure to delete selected entities ?'>Delete</button>
            {# <button type="button" class="btn btn-small btn-warning">Clone</button> #}
        </div>
    </form>

    {% if pager.haveToPaginate %}
        {{ pum_macros.pager(pager) }}
    {% endif %}
{% endblock %}
