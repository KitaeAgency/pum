<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <service id="pum" alias="pum_core.schema_manager" />
        <service id="pum.em_factory" factory-service="pum" factory-method="getExtension" class="Pum\Core\Extension\EmFactory\EmFactoryExtension">
            <argument type="constant">Pum\Core\Extension\EmFactory\EmFactoryExtension::NAME</argument>
        </service>

        <service id="pum_core.schema_manager" class="Pum\Core\SchemaManager">
            <argument type="service" id="pum_core.schema_manager.config" />
        </service>

        <service id="pum_core.schema_manager.config" class="Pum\Core\Config" public="false">
            <argument type="service" id="pum_core.schema_manager.config.driver" />
            <argument type="service" id="pum_core.type_factory" />
            <argument>%kernel.cache_dir%/pum_objects</argument>
            <argument type="collection" />
            <argument type="service" id="event_dispatcher" />
        </service>

        <!-- hardcoded today, later through configuration -->
        <service id="pum_core.schema_manager.config.driver" alias="pum_core.schema_manager.config.driver.doctrine_orm" />

        <service id="pum_core.type_factory" class="Pum\Core\Type\Factory\ServiceContainerTypeFactory">
            <argument type="service" id="service_container" />
            <argument>%pum_core.type_factory.service_ids%</argument>
        </service>

        <service id="pum_core.schema_manager.config.driver.doctrine_orm" class="Pum\Core\Driver\DoctrineOrmDriver" public="false">
            <argument type="service" id="doctrine.orm.default_entity_manager" />
        </service>
        <!-- end of hardcoded -->

        <!-- EXTENSIONS -->

        <service id="pum_core.extension.em_factory" class="Pum\Core\Extension\EmFactory\EmFactoryExtension" public="false">
            <argument type="service" id="doctrine.dbal.default_connection" />
            <tag name="pum.extension" />
        </service>

        <service id="pum_core.extension.form" class="Pum\Core\Extension\Form\FormExtension" public="false">
            <tag name="pum.extension" />
        </service>

        <!-- TYPES (must be public, lazy loaded) -->

        <service id="pum.type.text" class="Pum\Core\Type\TextType">
            <tag name="pum.type" alias="text" />
        </service>

        <service id="pum.type.integer" class="Pum\Core\Type\IntegerType">
            <tag name="pum.type" alias="integer" />
        </service>

        <service id="pum.type.boolean" class="Pum\Core\Type\BooleanType">
            <tag name="pum.type" alias="boolean" />
        </service>

        <service id="pum.type.decimal" class="Pum\Core\Type\DecimalType">
            <tag name="pum.type" alias="decimal" />
        </service>

        <service id="pum.type.date" class="Pum\Core\Type\DateType">
            <tag name="pum.type" alias="date" />
        </service>

        <service id="pum.type.datetime" class="Pum\Core\Type\DatetimeType">
            <tag name="pum.type" alias="datetime" />
        </service>

        <service id="pum.type.choice" class="Pum\Core\Type\ChoiceType">
            <tag name="pum.type" alias="choice" />
        </service>

    </services>
</container>
