{% extends "PumWoodworkBundle::layout.html.twig" %}

{% block javascript %}
<script>
(function(){
    var collectionHolder = $('ul.morefields');
    var $addTagLink = $('<hr/><a href="#" class="add_tag_link">Ajouter un field</a>');
    var $newLinkLi = $('<li></li>').append($addTagLink);

    function addTagForm(collectionHolder, $newLinkLi) {
        var prototype = collectionHolder.attr('data-prototype');
        var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);
        var $newFormLi = $('<li></li>').append(newForm);
        $newLinkLi.before($newFormLi);
        addTagFormDeleteLink($newFormLi);
    }

    function addTagFormDeleteLink($tagFormLi) {
        var $removeFormA = $('<a href="#">Supprimer ce field</a>');
        $tagFormLi.append($removeFormA);
        $removeFormA.on('click', function(e) {
            e.preventDefault();
            $tagFormLi.remove();
        });
    }

    jQuery(document).ready(function() {
        collectionHolder.find('li').each(function() {
            addTagFormDeleteLink($(this));
        });

        collectionHolder.append($newLinkLi);
        $addTagLink.on('click', function(e) {
            e.preventDefault();
            addTagForm(collectionHolder, $newLinkLi);
        });
    });
})();
</script>
{% endblock %}

{% block content %}
<h2>
        Beams &raquo; {{ beam.name }} &raquo; {{ objectName }} &raquo; edit
        <div class="btn-group pull-right">
            <a class="btn" href="{{ path('ww_object_definition_list', {beamName: beam.name}) }}"><i class="icon-chevron-left"></i>Back to definitions</a>
        </div>
</h2>
<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th> 
                <div>
                    {{ form_errors(form) }}

                    <form action="" method="POST" {{ form_enctype(form) }}>

                    {{ form_row(form.name) }}

                    <ul class="morefields" data-prototype="{{ form_widget(form.fields.vars.prototype)|e }}">
                        {% for field in form.fields %}
                            <li>{{ form_row(field.name) }} {{ form_row(field.type) }}</li>
                        {% endfor %}
                    </ul>

                   <br/>
                   {{form_rest(form)}}
                </form>
                </div>
            </th>
        </tr>
    </thead>
    <tbody>
       
    </tbody>
</table>
{% endblock %}
